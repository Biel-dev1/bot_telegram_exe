name: Compilar EXE PainelCity

on:
  workflow_dispatch:  # botão manual pra disparar se quiser

jobs:
  build:
    runs-on: windows-latest

    env:
      VCPKG_ROOT: C:\vcpkg
      VCPKG_DEFAULT_TRIPLET: x64-windows

    steps:
      - name: Checkout do código
        uses: actions/checkout@v3

      - name: Restaurar cache do vcpkg
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.VCPKG_ROOT }}\installed
            ${{ env.VCPKG_ROOT }}\packages
          key: ${{ runner.os }}-vcpkg-${{ env.VCPKG_DEFAULT_TRIPLET }}
          restore-keys: |
            ${{ runner.os }}-vcpkg-

      - name: Compilar PainelCity.exe com MSVC e dependências via vcpkg
        shell: cmd
        run: |
          call "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\Common7\Tools\VsDevCmd.bat"
          set INCLUDE=%VCPKG_ROOT%\installed\%VCPKG_DEFAULT_TRIPLET%\include;include;%INCLUDE%
          set LIB=%VCPKG_ROOT%\installed\%VCPKG_DEFAULT_TRIPLET%\lib;%LIB%
          cl painelcity.cpp /EHsc /std:c++17 ^
            /I"%VCPKG_ROOT%\installed\%VCPKG_DEFAULT_TRIPLET%\include" ^
            /I"include" ^
            /link ^
            /LIBPATH:"%VCPKG_ROOT%\installed\%VCPKG_DEFAULT_TRIPLET%\lib" ^
            libssl.lib libcrypto.lib crypt32.lib ^
            /OUT:PainelCity.exe

      - name: Upload do executável
        uses: actions/upload-artifact@v4
        with:
          name: painelcity-exe
          path: PainelCity.exe
